!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?t(require("jquery")):t(jQuery)}(function(t){"use strict";var a=window.console||{log:function(){}};function CropAvatar(a){this.$container=a,this.$avatarView=this.$container.find(".avatar-view"),this.$avatar=this.$avatarView.find("img"),this.$avatarModal=t("body").find("#avatar-modal"),this.$loading=t("#page-wrapper").find(".loading"),this.$avatarForm=this.$avatarModal.find(".avatar-form"),this.$avatarUpload=this.$avatarForm.find(".avatar-upload"),this.$avatarSrc=this.$avatarForm.find(".avatar-src"),this.$avatarData=this.$avatarForm.find(".avatar-data"),this.$avatarInput=this.$avatarForm.find(".avatar-input"),this.$avatarSave=this.$avatarForm.find(".avatar-save"),this.$avatarBtns=this.$avatarForm.find(".avatar-btns"),this.$avatarWrapper=this.$avatarModal.find(".avatar-wrapper"),this.$avatarPreview=this.$avatarModal.find(".avatar-preview"),this.init()}CropAvatar.prototype={constructor:CropAvatar,support:{fileList:!!t('<input type="file">').prop("files"),blobURLs:!!window.URL&&URL.createObjectURL,formData:!!window.FormData},init:function(){this.support.datauri=this.support.fileList&&this.support.blobURLs,this.initModal(),this.addListener()},addListener:function(){this.$avatarView.on("click",t.proxy(this.click,this)),this.$avatarInput.on("change",t.proxy(this.change,this)),this.$avatarForm.on("submit",t.proxy(this.submit,this)),this.$avatarBtns.on("click",t.proxy(this.rotate,this))},initModal:function(){this.$avatarModal.modal({show:!1})},initPreview:function(){this.$avatar.attr("src")},initIframe:function(){var i="upload-iframe-"+(new Date).getTime(),r=t("<iframe>").attr({name:i,src:""}),s=this;r.one("load",function(){r.on("load",function(){var i;try{i=t(this).contents().find("body").text()}catch(t){a.log(t.message)}if(i){try{i=t.parseJSON(i)}catch(t){a.log(t.message)}s.submitDone(i)}else s.submitFail("Image upload failed!");s.submitEnd()})}),this.$iframe=r,this.$avatarForm.attr("target",i).after(r.hide())},click:function(){this.$avatarModal.modal("show"),this.initPreview()},change:function(){var t,a;this.support.datauri?(t=this.$avatarInput.prop("files")).length>0&&(a=t[0],this.isImageFile(a)&&(this.url&&URL.revokeObjectURL(this.url),this.url=URL.createObjectURL(a),this.startCropper())):(a=this.$avatarInput.val(),this.isImageFile(a)&&this.syncUpload())},submit:function(){return!(!this.$avatarSrc.val()&&!this.$avatarInput.val())&&(this.support.formData?(this.ajaxUpload(),!1):void 0)},rotate:function(a){var i;this.active&&(i=t(a.target).data()).method&&this.$img.cropper(i.method,i.option)},isImageFile:function(t){return t.type?/^image\/\w+$/.test(t.type):/\.(jpg|jpeg|png|gif)$/.test(t)},startCropper:function(){this.active?this.$img.cropper("replace",this.url):(this.$img=t('<img src="'+this.url+'">'),this.$avatarWrapper.empty().html(this.$img),this.$img.cropper({aspectRatio:1,preview:this.$avatarPreview.selector,strict:!1}),this.active=!0)},stopCropper:function(){this.active&&(this.$img.cropper("destroy"),this.$img.remove(),this.active=!1)},syncUpload:function(){this.$avatarSave.click()},submitStart:function(){this.$loading.fadeIn()},submitFail:function(t){this.alert(t)},submitEnd:function(){this.$loading.fadeOut()},cropDone:function(){this.$avatarForm.get(0).reset(),this.$avatar.attr("src",this.url),this.stopCropper(),this.$avatarModal.modal("hide")},alert:function(t){var a=['<div class="alert alert-danger avater-alert">','<button type="button" class="close" data-dismiss="alert">&times;</button>',t,"</div>"].join("");this.$avatarUpload.after(a)}},t(function(){return new CropAvatar(t("#crop-avatar"))})});