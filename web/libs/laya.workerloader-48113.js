var createImageBitmapOK=!!self.createImageBitmap;onmessage=function(e){var a=e.data;loadImage2(a.url,a.options)};var enableTrace=!1,ifShowTraceToMain=!1;function myTrace(e){enableTrace&&ifShowTraceToMain&&showMsgToMain(e)}function loadImage2(e,a){var t=!1,n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",myTrace("load:"+e),n.onload=function(){var o=n.response||n.mozResponseArrayBuffer;(myTrace("onload:"+e),200!=n.status&&0!=n.status||o.byteLength<10)?t||(t=!0,pngFail(e,"loadFail from onload"+n.status)):doCreateImageBitmap(new Uint8Array(o),e,a)},n.onerror=function(a){pngFail(e,"loadFail")},n.send(null)}function doCreateImageBitmap(e,a,t){try{var n=getTimeNow();e=new self.Blob([e],{type:"image/png"}),self.createImageBitmap(e,t).then((function(e){var t={};t.url=a,t.imageBitmap=e,t.dataType="imageBitmap",t.startTime=n,t.decodeTime=getTimeNow()-n,t.sendTime=getTimeNow(),myTrace("png:Decode By createImageBitmap,"+t.decodeTime,a),t.type="Image",postMessage(t,[t.imageBitmap])})).catch((function(e){showMsgToMain("catch e:"+e),pngFail(a,"parse fail"+e+":ya")}))}catch(e){pngFail(a,"parse fail"+e.toString()+":ya")}}function getTimeNow(){return(new Date).getTime()}function disableWorker(e){var a={};a.url=url,a.imagedata=null,a.type="Disable",a.msg=e,postMessage(a)}function pngFail(e,a){var t={};t.url=e,t.imagedata=null,t.type="Image",t.msg=a,postMessage(t)}function showMsgToMain(e){var a={type:"Msg"};a.msg=e,postMessage(a)}